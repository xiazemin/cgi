# CGI中的信号量和文件锁

  因为CGI程序时公用的，而WEB服务器都支持多进程运行，因此可能会发生同时有多个用户访问同一个CGI程序的情况。比如，有2个用户几乎同时访问同一个CGI程序，服务器为他们创建了2个CGI程序进程，设为进程A和进程B。假如进程A首先打开了某个文件，然后由于某种原因被挂起（一般是由于操作系统的进程调度）；而就在进程A被挂起的这段时间内，进程B完成了对文件的整个操作流程：打开，写入，关闭；进程A再继续往下执行，但进程A所操作的文件依旧是原来文件的就版本，此时进程A的操作结果将覆盖进程B的操作结果。



为了防止这种情况发生，需要用到文件锁或者信号量。



钥匙文件？



 



假如有多个不同的HTML可以调用同一个CGI程序，那么CGI程序如何区分它们呢？一个是通过隐含的INPUT标签。不过觉得这个比较麻烦，因为CGI必须经过一系列解码后才能找到这个隐含INPUT的变量和其值。



五．设置HTTP服务器以兼容CGI

       用Perl编写的CGI程序后缀为：.pl；Python编写的CGI程序后缀为：.py；而C编写的CGI程序后缀为：.cgi，如果在win下编译出来的是.exe，最好将它重命名为.cgi。这些都是为了HTTP服务能够识别并调用它们。



       当使用appche httpd服务器时，请编辑它的配置文件httpd.conf如下：



       修改AddHandler cgi-script一句为AddHandler cgi-script .cgi .py.pl



六．关于CGI的C语言库——cgihtml

       Cgihtml是一个应用非常广泛的C语言编写的CGI库。它提供的功能函数如下：



       Read\_cgi\_input\(\)：获取并解析HTML表单输入，返回一个指向某结构体的指针



       Cgi\_val\(\)：获取每个表单变量的值



       Html\_header\(\):输出HTML标题栏



       Html\_begin\(\):输出HTML文档的开始部分



       H1\(\):输出一行字符，字体为H1



Html\_end\(\):输出HTML文档的结尾部分。



\#include “cgi-lib.h”



\#include “html-lib.h”



\#include “string-lib.h”



六．后话

有的人认为可以用JavaScript来代替CGI程序，这其实是一个概念上的错误。JavaScript只能够在客户浏览器中运行，而CGI却是工作在服务器上的。他们所做的工作有一些交集，比如表单数据验证一类的，但是JavaScript是绝对无法取代CGI的。但可以这样说，如果一项工作即能够用JavaScript来做，又可以用CGI来做，那么绝对要使用JavaScript，在执行的速度上，JavaScript比CGI有着先天的优势。只有那些在客户端解决不了的问题，比如和某个远程数据库交互，这时就应该使用CGI了。



 



 



SSI:一种用来动态输出HTML文本的特殊程序。



网页里包含有某个变量，提交给服务器后，只有该变量改变。此时我们希望服务器不要把整个页面内容都发送过来，而只需要告诉客户端的浏览器，哪个变量的值便成什么样了，浏览器会自动更新。



SSI在服务器端运行。



SSI不需要外部接口，它不像CGI从标准输入接收信息。



你浏览你的HTML文档时看不到SSI标记，因为它已经被相应的程序输出所替代。



所有的SSI命令都是嵌入在普通的HTML注释行中的。当服务器无法解释SSI时，它将不解释并直接把文档传给浏览器，由于命令在注释中，故浏览器将忽略它们。而当服务器识别SSI时，它并不将该命令传给浏览器，相反，服务器将从上到下扫描HTML文档，执行每一个嵌入注释的命令，并将命令的执行结果代替原注释。



&lt;! –注释文本--&gt;。服务器将根本不查看注释，除非已启动SSI。



与纯注释不同的是，所有的SSI命令都是以\#打头。



&lt;!--\#command tagname = “parameter”-- &gt;,command指出服务器做什么，tagname指出参数类型，parameter是该命令的用户定义值。



The currentdate is&lt;! --\#echo var = “DATE.LOCAL”-- &gt;，服务器将向浏览器输出时间。

